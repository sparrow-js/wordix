!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@tiptap/core"),require("@tiptap/pm/state"),require("@tiptap/pm/view"),require("@tiptap/pm/model")):"function"==typeof define&&define.amd?define(["exports","@tiptap/core","@tiptap/pm/state","@tiptap/pm/view","@tiptap/pm/model"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["@tiptap-pro/extension-node-range"]={},e.core,e.state,e.view,e.model)}(this,(function(e,t,o,n,s){"use strict";function r(e){if(!e.length)return n.DecorationSet.empty;const t=[],o=e[0].$from.node(0);return e.forEach((e=>{const o=e.$from.pos,s=e.$from.nodeAfter;s&&t.push(n.Decoration.node(o,o+s.nodeSize,{class:"ProseMirror-selectednoderange"}))})),n.DecorationSet.create(o,t)}function i(e,t,n){const r=[],i=e.node(0);n="number"==typeof n&&n>=0?n:e.sameParent(t)?Math.max(0,e.sharedDepth(t.pos)-1):e.sharedDepth(t.pos);const a=new s.NodeRange(e,t,n),c=0===a.depth?0:i.resolve(a.start).posAtIndex(0);return a.parent.forEach(((e,t)=>{const n=c+t,s=n+e.nodeSize;if(n<a.start||n>=a.end)return;const h=new o.SelectionRange(i.resolve(n),i.resolve(s));r.push(h)})),r}class a{constructor(e,t){this.anchor=e,this.head=t}map(e){return new a(e.map(this.anchor),e.map(this.head))}resolve(e){const t=e.resolve(this.anchor),o=e.resolve(this.head);return new c(t,o)}}class c extends o.Selection{constructor(e,t,o,n=1){const{doc:s}=e,r=e===t,a=e.pos===s.content.size&&t.pos===s.content.size,c=r&&!a?s.resolve(t.pos+(n>0?1:-1)):t,h=r&&a?s.resolve(e.pos-(n>0?1:-1)):e,d=i(h.min(c),h.max(c),o);super(c.pos>=e.pos?d[0].$from:d[d.length-1].$to,c.pos>=e.pos?d[d.length-1].$to:d[0].$from,d),this.depth=o}get $to(){return this.ranges[this.ranges.length-1].$to}eq(e){return e instanceof c&&e.$from.pos===this.$from.pos&&e.$to.pos===this.$to.pos}map(e,t){const o=e.resolve(t.map(this.anchor)),n=e.resolve(t.map(this.head));return new c(o,n)}toJSON(){return{type:"nodeRange",anchor:this.anchor,head:this.head}}get isForwards(){return this.head>=this.anchor}get isBackwards(){return!this.isForwards}extendBackwards(){const{doc:e}=this.$from;if(this.isForwards&&this.ranges.length>1){const e=this.ranges.slice(0,-1),t=e[0].$from,o=e[e.length-1].$to;return new c(t,o,this.depth)}const t=this.ranges[0],o=e.resolve(Math.max(0,t.$from.pos-1));return new c(this.$anchor,o,this.depth)}extendForwards(){const{doc:e}=this.$from;if(this.isBackwards&&this.ranges.length>1){const e=this.ranges.slice(1),t=e[0].$from,o=e[e.length-1].$to;return new c(o,t,this.depth)}const t=this.ranges[this.ranges.length-1],o=e.resolve(Math.min(e.content.size,t.$to.pos+1));return new c(this.$anchor,o,this.depth)}static fromJSON(e,t){return new c(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,o,n,s=1){return new this(e.resolve(t),e.resolve(o),n,s)}getBookmark(){return new a(this.anchor,this.head)}}function h(e){return e instanceof c}c.prototype.visible=!1;const d=t.Extension.create({name:"nodeRange",addOptions:()=>({depth:void 0,key:"Mod"}),addKeyboardShortcuts(){return{"Shift-ArrowUp":({editor:e})=>{const{depth:t}=this.options,{view:o,state:n}=e,{doc:s,selection:r,tr:i}=n,{anchor:a,head:d}=r;if(!h(r)){const e=c.create(s,a,d,t,-1);return i.setSelection(e),o.dispatch(i),!0}const p=r.extendBackwards();return i.setSelection(p),o.dispatch(i),!0},"Shift-ArrowDown":({editor:e})=>{const{depth:t}=this.options,{view:o,state:n}=e,{doc:s,selection:r,tr:i}=n,{anchor:a,head:d}=r;if(!h(r)){const e=c.create(s,a,d,t);return i.setSelection(e),o.dispatch(i),!0}const p=r.extendForwards();return i.setSelection(p),o.dispatch(i),!0},"Mod-a":({editor:e})=>{const{depth:t}=this.options,{view:o,state:n}=e,{doc:s,tr:r}=n,i=c.create(s,0,s.content.size,t);return r.setSelection(i),o.dispatch(r),!0}}},onSelectionUpdate(){const{selection:e}=this.editor.state;h(e)&&this.editor.view.dom.classList.add("ProseMirror-noderangeselection")},addProseMirrorPlugins(){let e=!1,t=!1;return[new o.Plugin({key:new o.PluginKey("nodeRange"),props:{attributes:()=>e?{class:"ProseMirror-noderangeselection"}:{class:""},handleDOMEvents:{mousedown:(e,o)=>{const{key:n}=this.options,s=/Mac/.test(navigator.platform),r=!!o.shiftKey,i=!!o.ctrlKey,a=!!o.altKey,h=!!o.metaKey;return(null==n||"Shift"===n&&r||"Control"===n&&i||"Alt"===n&&a||"Meta"===n&&h||"Mod"===n&&(s?h:i))&&(t=!0),!!t&&(document.addEventListener("mouseup",(()=>{t=!1;const{state:o}=e,{doc:n,selection:s,tr:r}=o,{$anchor:i,$head:a}=s;if(i.sameParent(a))return;const h=c.create(n,i.pos,a.pos,this.options.depth);r.setSelection(h),e.dispatch(r)}),{once:!0}),!1)}},decorations:o=>{const{selection:n}=o,s=h(n);if(e=!1,!t)return s?(e=!0,r(n.ranges)):null;const{$from:a,$to:c}=n;if(!s&&a.sameParent(c))return null;const d=i(a,c,this.options.depth);return d.length?(e=!0,r(d)):null}}})]}});e.NodeRange=d,e.NodeRangeSelection=c,e.default=d,e.getNodeRangeDecorations=r,e.getSelectionRanges=i,e.isNodeRangeSelection=h,Object.defineProperty(e,"__esModule",{value:!0})}));
